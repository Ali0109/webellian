# Webellian Technical Task

## ğŸ› ï¸ Task Demonstration:

Developed a Python FastAPI application for managing shop inventory. The application includes the following functionalities:

## ğŸ“¦ Catalog Management:

- Functionality for retrieving a list of catalogs with pagination.
- Functionality for add, update, or delete catalogs with async database connection and high throughput system performance.

## ğŸ›’ Product Management:

- Retrieve a list of products within a specific catalog.
- Create, update, or delete products.
- Assign or remove a product from a catalog.

## ğŸ“‘ API Documentation and Testing:

- Provided API documentation using Swagger (OpenAPI), which is built-in with FastAPI.
- Application can be tested effectively via the auto-generated Swagger UI at http://localhost:9000/docs.

## ğŸ—„ï¸ Database:

- Persistent database PostgreSQL with ORM SQLAlchemy (async).
- Database migrations using Alembic.
- Clean architecture with ORM models, repositories, services, and routers.

## âœ… Architecture:

- **Model Layer**: ORM models (SQLAlchemy 2.0) representing Catalog and Product entities.
- **Repository Layer**: Data access layer using async SQLAlchemy. Repositories accept and return Pydantic schemas.
- **Service Layer**: Business logic layer (SRP) that uses repositories.
- **Router Layer**: API endpoints (controllers) that use services with dependency injection.
- **Schema Layer**: Pydantic models for API request/response validation with BaseSchema for common configuration.

## ğŸ“‚ Features Implemented:

- âœ… Dependency injection using FastAPI Depends.
- âœ… Unit tests with pytest and httpx.
- âœ… Docker and Docker Compose setup.
- âœ… Proper logging throughout the application.
- âœ… Error handling with custom exceptions.
- âœ… Async database operations for high performance.

## ğŸš€ Getting Started

### Prerequisites

- Docker and Docker Compose installed
- Python 3.13 (if running locally)

### Running with Docker Compose (Recommended)

1. Clone the repository:
```bash
git clone https://github.com/Ali0109/webellian
cd webellian
```

2. Build and start the application:
```bash
docker-compose up --build
```

3. The application will be available at:
   - API: http://localhost:9000
   - Swagger UI: http://localhost:9000/docs
   - ReDoc: http://localhost:9000/redoc

4. To stop the application:
```bash
docker-compose down
```

### Running Locally

1. Install dependencies using `uv`:
```bash
uv pip install -e .
```

2. Make sure PostgreSQL is running and update DATABASE_URL in `.env` file if needed.

3. Run database migrations:
```bash
alembic upgrade head
```

4. Run the application:
```bash
uvicorn app.main:app --host 0.0.0.0 --port 9000 --reload
```

## ğŸ§ª Running Tests

To run the test suite:

```bash
make test
```

or

```bash
uv run pytest tests/ -v
```

## ğŸ“ Project Structure

```
webellian/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # FastAPI application entry point
â”‚   â”œâ”€â”€ config.py            # Application configuration
â”‚   â”œâ”€â”€ database.py          # Database connection and session management
â”‚   â”œâ”€â”€ exceptions.py        # Custom exceptions
â”‚   â”œâ”€â”€ models/              # ORM models (SQLAlchemy 2.0)
â”‚   â”‚   â”œâ”€â”€ catalog.py
â”‚   â”‚   â””â”€â”€ product.py
â”‚   â”œâ”€â”€ repositories/        # Data access layer
â”‚   â”‚   â”œâ”€â”€ catalog_repository.py
â”‚   â”‚   â””â”€â”€ product_repository.py
â”‚   â”œâ”€â”€ services/            # Business logic layer (SRP)
â”‚   â”‚   â”œâ”€â”€ catalog/
â”‚   â”‚   â”‚   â”œâ”€â”€ create_catalog.py
â”‚   â”‚   â”‚   â”œâ”€â”€ get_catalog.py
â”‚   â”‚   â”‚   â”œâ”€â”€ get_catalog_list.py
â”‚   â”‚   â”‚   â”œâ”€â”€ update_catalog.py
â”‚   â”‚   â”‚   â””â”€â”€ delete_catalog.py
â”‚   â”‚   â””â”€â”€ product/
â”‚   â”‚       â”œâ”€â”€ create_product.py
â”‚   â”‚       â”œâ”€â”€ get_product.py
â”‚   â”‚       â”œâ”€â”€ get_product_list.py
â”‚   â”‚       â”œâ”€â”€ update_product.py
â”‚   â”‚       â”œâ”€â”€ delete_product.py
â”‚   â”‚       â”œâ”€â”€ assign_to_catalog.py
â”‚   â”‚       â””â”€â”€ remove_from_catalog.py
â”‚   â”œâ”€â”€ routers/             # API endpoints (controllers)
â”‚   â”‚   â”œâ”€â”€ catalogs.py
â”‚   â”‚   â””â”€â”€ products.py
â”‚   â””â”€â”€ schemas/             # Pydantic models for API
â”‚       â”œâ”€â”€ base.py          # BaseSchema with model_config
â”‚       â”œâ”€â”€ catalog.py
â”‚       â””â”€â”€ product.py
â”œâ”€â”€ alembic/                 # Database migrations
â”‚   â”œâ”€â”€ env.py
â”‚   â”œâ”€â”€ versions/
â”‚   â””â”€â”€ script.py.mako
â”œâ”€â”€ tests/                   # Unit tests
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ test_catalogs.py
â”‚   â””â”€â”€ test_products.py
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ pyproject.toml            # Project configuration (uv, ruff)
â”œâ”€â”€ alembic.ini              # Alembic configuration
â”œâ”€â”€ Makefile                 # Development commands
â””â”€â”€ README.md
```

## ğŸ”§ Configuration

Environment variables can be set in `.env` file:

- `DATABASE_URL`: PostgreSQL connection string (default: `postgresql+asyncpg://postgres:postgres@db:5432/webellian_db`)
- `DEBUG`: Enable debug mode (default: `False`)

## ğŸ› ï¸ Development

### Installing Dependencies

The project uses `uv` for package management:

```bash
# Install uv if not already installed
pip install uv

# Install project dependencies
uv pip install -e .
```

### Code Quality

The project uses `ruff` for linting and formatting:

```bash
# Format code
make format
# or
ruff format app tests

# Lint code
make lint
# or
ruff check app tests

# Run all checks
make dev
```

### Running Tests

```bash
# Run tests
make test
# or
uv run pytest tests/ -v
```

## ğŸ“ Architecture Notes

- **Single Responsibility Principle (SRP)**: Each service class has a single responsibility (e.g., `CreateCatalog`, `UpdateCatalog`, etc.).
- **Dependency Injection**: Services are injected into routers via FastAPI's `Depends`. Database transactions are managed by FastAPI's dependency system.
- **Async Operations**: All database operations are async for better performance.
- **Clean Architecture**: The application follows clean architecture principles with clear separation of concerns:
  - Model layer: ORM models (SQLAlchemy 2.0 with Mapped syntax)
  - Repository layer: Data access (accepts and returns Pydantic schemas)
  - Service layer: Business logic (split by SRP)
  - Router layer: API endpoints
- **Logging**: Configured throughout the application for better observability.
- **Code Quality**: The project uses `ruff` for linting and formatting (configured in `pyproject.toml`).
